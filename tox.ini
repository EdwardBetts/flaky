[tox]
envlist =
    py36,
    py37,
    py38,
    py39,
    pypy3,
    pycodestyle,
    pylint,
    readme,
    coverage

[testenv]
deps = -rrequirements-dev.txt
usedevelop = True
commands =
    pytest -k 'not options' --doctest-modules test/
    pytest -k 'not options' -n 1 test/
    pytest --force-flaky --max-runs 2  test/test_pytest_options_example.py

[testenv:pycodestyle]
commands =
    pycodestyle --ignore=E501 flaky
    pycodestyle --ignore=E501 test

[testenv:pylint]
commands =
    pylint --rcfile=.pylintrc flaky
    pylint --rcfile=.pylintrc test -d C0330,W0621,C0411

[testenv:coverage]
commands =
    python setup.py develop
    pytest -k 'not options' --doctest-modules --no-flaky-report --cov flaky --cov-report term-missing  test/

[testenv:readme]
deps =
    docutils
    pygments
commands =
  rst2html.py --strict README.rst
  rst2html.py --strict HISTORY.rst
  rst2html.py --strict CONTRIBUTING.rst

[pycodestyle]
show-pep8 = True
show-source = True
